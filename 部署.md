


手动配置节点

```shell
export EDGE_NODE="localhost.localdomain"
kubectl label node ${EDGE_NODE} openyurt.io/is-edge-worker=true
kubectl annotate node ${EDGE_NODE} node.beta.openyurt.io/autonomy=true
```




```shell
export WORKER_NODEPOOL="raspberry"
export EDGE_NODE="localhost.localdomain"

cat <<EOF | kubectl apply -f -
apiVersion: apps.openyurt.io/v1alpha1
kind: NodePool
metadata:
  name: $WORKER_NODEPOOL
spec:
  type: Edge
EOF

# 将边缘节点加入节点池
kubectl label node $EDGE_NODE apps.openyurt.io/desired-nodepool=${WORKER_NODEPOOL}

# 检查节点池状态
kubectl get nodepool
```










```yaml
export WORKER_NODEPOOL="raspberry"
kubectl delete edgex edgex-sample-$WORKER_NODEPOOL
export VIRTUAL_DEVICE_IMAGE="edgexfoundry/docker-device-virtual-go:1.3.0"
export DEVICE_REST_IMAGE="edgexfoundry/docker-device-rest-go:1.2.0"
cat <<EOF | kubectl apply -f -
apiVersion: device.openyurt.io/v1alpha1
kind: EdgeX
metadata:
  name: edgex-sample-$WORKER_NODEPOOL
spec:
  version: hanoi
  poolname: $WORKER_NODEPOOL
  additinalservices:
  - metadata:
      name: edgex-device-virtual
    spec:
      type: NodePort
      selector:
        app: edgex-device-virtual
      ports:
      - name: http
        port: 49990
        protocol: TCP
        targetPort: 49990
        nodePort: 30090
  - metadata:
      name: edgex-device-rest
    spec:
      type: NodePort
      selector:
        app: edgex-device-rest
      ports:
      - name: http
        port: 49986
        protocol: TCP
        targetPort: 49986
        nodePort: 30086
  - metadata:
      name: edgex-ui
    spec:
      type: NodePort
      selector:
        app: edgex-ui
      ports:
      - name: http
        port: 4000
        protocol: TCP
        targetPort: 4000
  - metadata:
      name: edgex-app-service-configurable-mqtt
    spec:
      type: NodePort
      selector:
        app: edgex-app-service-configurable-mqtt
      ports:
      - name: http
        port: 48101
        protocol: TCP
        targetPort: 48101 
        nodePort: 30200
  - metadata:
      name: edgex-sys-mgmt-agent
    spec:
      type: NodePort
      selector:
        app: edgex-sys-mgmt-agent
      ports:
      - name: http
        port: 48090
        protocol: TCP
        targetPort: 48090 
        nodePort: 30990
        
  additinaldeployments:
  - metadata:
      name: edgex-device-virtual
    spec:
      selector:
        matchLabels:
          app: edgex-device-virtual
      template:
        metadata:
          labels:
            app: edgex-device-virtual
        spec:
          hostname: edgex-device-virtual
          tolerations:
          - effect: NoSchedule
            operator: Exists
          containers:
          - name: edgex-device-virtual
            image: $VIRTUAL_DEVICE_IMAGE
            imagePullPolicy: IfNotPresent
            ports:
            - name: http
              protocol: TCP
              containerPort: 49990
            envFrom:
            - configMapRef:
                name: common-variables
            env:
              - name: Service_Host
                value: "edgex-device-virtual"
  - metadata:
      name: edgex-device-rest
    spec:
      selector:
        matchLabels:
          app: edgex-device-rest
      template:
        metadata:
          labels:
            app: edgex-device-rest
        spec:
          hostname: edgex-device-rest
          tolerations:
          - effect: NoSchedule
            operator: Exists
          containers:
          - name: edgex-device-rest
            image: $DEVICE_REST_IMAGE
            imagePullPolicy: IfNotPresent
            ports:
            - name: http
              protocol: TCP
              containerPort: 49986
            envFrom:
            - configMapRef:
                name: common-variables
            env:
              - name: Service_Host
                value: "edgex-device-rest"
  - metadata:
      name: edgex-ui
    spec:
      selector:
        matchLabels:
          app: edgex-ui
      template:
        metadata:
          labels:
            app: edgex-ui
        spec:
          hostname: edgex-ui
          tolerations:
          - effect: NoSchedule
            operator: Exists
          containers:
          - name: edgex-ui
            image: edgexfoundry/docker-edgex-ui-go:1.3.0
            imagePullPolicy: IfNotPresent
            ports:
            - name: http
              protocol: TCP
              containerPort: 4000
            envFrom:
            - configMapRef:
                name: common-variables
            env:
              - name: Service_Host
                value: "edgex-ui" 

  - metadata:
      name: edgex-app-service-configurable-mqtt
    spec:
      selector:
        matchLabels:
          app: edgex-app-service-configurable-mqtt
      template:
        metadata:
          labels:
            app: edgex-app-service-configurable-mqtt
        spec:
          hostname: edgex-app-service-configurable-mqtt
          tolerations:
          - effect: NoSchedule
            operator: Exists
          containers:
          - name: edgex-app-service-configurable-mqtt
            image: edgexfoundry/docker-app-service-configurable:1.1.0
            imagePullPolicy: IfNotPresent
            ports:
            - name: http
              protocol: TCP
              containerPort: 48101
            envFrom:
            - configMapRef:
                name: common-variables
            env:
              - name: edgex_profile
                value: "mqtt-export"
              - name: Service_Host
                value: "edgex-app-service-configurable-mqtt"
              - name: Service_Port
                value: "48101"
              - name: MessageBus_SubscribeHost_Host
                value: "edgex-core-data"
              - name: Binding_PublishTopic
                value: "events"
              - name: Writable_Pipeline_Functions_MQTTSend_Addressable_Address
                value: "broker.mqttdashboard.com"
              - name: Writable_Pipeline_Functions_MQTTSend_Addressable_Port
                value: "1883"
              - name: Writable_Pipeline_Functions_MQTTSend_Addressable_Protocol
                value: "tcp"
              - name: Writable_Pipeline_Functions_MQTTSend_Addressable_Publisher
                value: "edgex"
              - name: Writable_Pipeline_Functions_MQTTSend_Addressable_Topic
                value: "EdgeXEvents"

  - metadata:
      name: edgex-sys-mgmt-agent
    spec:
      selector:
        matchLabels:
          app: edgex-sys-mgmt-agent
      template:
        metadata:
          labels:
            app: edgex-sys-mgmt-agent
        spec:
          hostname: edgex-sys-mgmt-agent
          volumes:
            - name: edgex-sys-mgmt-agent
              hostPath:
                path: /var/run/
                type: DirectoryOrCreate
          tolerations:
          - effect: NoSchedule
            operator: Exists
          containers:
          - name: edgex-sys-mgmt-agent
            image: edgexfoundry/docker-sys-mgmt-agent-go:1.3.0
            ports:
            - name: http
              protocol: TCP
              containerPort: 48090
            envFrom:
            - configMapRef:
                name: common-variables
            env:
              - name: EXECUTORPATH
                value: "/sys-mgmt-executor"
              - name: METRICSMECHANISM
                value: "executor"
              - name: SERVICE_HOST
                value: "edgex-sys-mgmt-agent" 
            volumeMounts:
            - name: edgex-sys-mgmt-agent
              mountPath: /var/run/docker.sock
              subPath: docker.sock

EOF

```